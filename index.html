<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Coach Salade 2.1</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Montserrat:wght@400;500&display=swap" rel="stylesheet">
  <style>
    html, body {
      height: 100%;
      margin: 0;
      font-family: 'Montserrat', sans-serif;
      background: linear-gradient(135deg, #ec4899cc 0%, #7f9cf5cc 100%), url('ChatGPT Image 7 juil. 2025, 16_23_26.png') center center / cover no-repeat fixed;
      min-height: 100vh;
      background-attachment: fixed;
    }
    h1, h2, .font-display {
      font-family: 'Playfair Display', serif;
    }
    .card {
      background: rgba(255,255,255,0.75);
      backdrop-filter: blur(10px);
      border-radius: 1.5rem;
      box-shadow: 0 4px 32px 0 rgba(0,0,0,0.08);
      padding: 1.5rem;
      margin-bottom: 1rem;
    }
  </style>
</head>
<body class="flex flex-col items-center justify-center min-h-screen">

  <!-- Menu principal -->
  <div id="menu-view" class="w-full max-w-md mx-auto flex flex-col items-center justify-center min-h-screen">
    <div class="card w-full text-center">
      <h1 class="font-display text-3xl mb-4">Coach Salade 🥗</h1>
      <button onclick="showView('generator-salad-view')" class="w-full mb-3 px-4 py-3 rounded-2xl bg-pink-500 text-white font-bold text-lg shadow-md transition hover:bg-pink-600">Générer une Salade</button>
      <button onclick="showView('generator-plat-view')" class="w-full mb-3 px-4 py-3 rounded-2xl bg-yellow-400 text-gray-800 font-bold text-lg shadow-md transition hover:bg-yellow-500">Générer un Plat</button>
      <button onclick="showView('composer-type-view')" class="w-full px-4 py-3 rounded-2xl bg-white border-2 border-pink-500 text-pink-500 font-bold text-lg shadow-md transition hover:bg-pink-50">Composer</button>
      <button onclick="showView('batch-view')" class="w-full mt-3 px-4 py-3 rounded-2xl bg-blue-500 text-white font-bold text-lg shadow-md transition hover:bg-blue-600">Planification Semaine</button>
    </div>
    <footer class="text-xs text-gray-600 opacity-80 mt-12">Coach Salade 2.1 • © 2025</footer>
  </div>

  <!-- Générateur de Salade -->
  <div id="generator-salad-view" class="hidden w-full max-w-md mx-auto flex flex-col items-center min-h-screen pt-6">
    <button onclick="showView('menu-view')" class="mb-2 text-pink-500 font-semibold flex items-center gap-1">⬅️ Menu</button>
    <div class="card w-full">
      <h2 class="font-display text-2xl mb-3">Générateur de Salade 🎲</h2>
      <button id="generate-salad-btn" onclick="generateSalad()" class="w-full px-4 py-3 rounded-2xl bg-pink-500 text-white font-bold text-lg shadow-md transition hover:bg-pink-600">Nouvelle Salade</button>
      <div id="generator-salad-result" class="mt-6"></div>
    </div>
  </div>

  <!-- Générateur de Plat -->
  <div id="generator-plat-view" class="hidden w-full max-w-md mx-auto flex flex-col items-center min-h-screen pt-6">
    <button onclick="showView('menu-view')" class="mb-2 text-yellow-500 font-semibold flex items-center gap-1">⬅️ Menu</button>
    <div class="card w-full">
      <h2 class="font-display text-2xl mb-3">Générateur de Plat 🍽️</h2>
      <button id="generate-plat-btn" onclick="generatePlat()" class="w-full px-4 py-3 rounded-2xl bg-yellow-400 text-gray-800 font-bold text-lg shadow-md transition hover:bg-yellow-500">Nouveau Plat</button>
      <div id="generator-plat-result" class="mt-6"></div>
    </div>
  </div>
  <!-- Sélecteur type compositeur -->
  <div id="composer-type-view" class="hidden w-full max-w-md mx-auto flex flex-col items-center min-h-screen pt-6">
    <button onclick="showView('menu-view')" class="mb-2 text-pink-500 font-semibold flex items-center gap-1">⬅️ Menu</button>
    <div class="card w-full text-center">
      <h2 class="font-display text-2xl mb-3">Composer une recette</h2>
      <p class="mb-4">Que veux-tu composer&nbsp;?</p>
      <button onclick="selectComposerType('salad')" class="w-full mb-3 px-4 py-3 rounded-2xl bg-pink-500 text-white font-bold text-lg shadow-md transition hover:bg-pink-600">Salade</button>
      <button onclick="selectComposerType('plat')" class="w-full px-4 py-3 rounded-2xl bg-yellow-400 text-gray-800 font-bold text-lg shadow-md transition hover:bg-yellow-500">Plat</button>
    </div>
  </div>

  <!-- Compositeur -->
  <div id="composer-view" class="hidden w-full max-w-md mx-auto flex flex-col items-center min-h-screen pt-6">
    <button onclick="showView('composer-type-view')" class="mb-2 text-pink-500 font-semibold flex items-center gap-1">⬅️ Retour</button>
    <div class="card w-full">
      <h2 id="composer-title" class="font-display text-2xl mb-3"></h2>
      <form id="composer-form" onsubmit="event.preventDefault(); composeSaladPlat();">
        <div id="composer-ingredients"></div>
        <button type="submit" class="w-full mt-4 px-4 py-3 rounded-2xl bg-pink-500 text-white font-bold text-lg shadow-md transition hover:bg-pink-600">Composer</button>
      </form>
      <div id="composer-result" class="mt-6"></div>
    </div>
  </div>

  <!-- Planification Semaine -->
  <div id="batch-view" class="hidden w-full max-w-md mx-auto flex flex-col items-center min-h-screen pt-6">
    <button onclick="showView('menu-view')" class="mb-2 text-blue-500 font-semibold flex items-center gap-1">⬅️ Menu</button>
    <div class="card w-full">
      <h2 class="font-display text-2xl mb-3">Planification semaine 📅</h2>
      <button onclick="generateBatch()" class="w-full px-4 py-3 rounded-2xl bg-blue-500 text-white font-bold text-lg shadow-md transition hover:bg-blue-600">Générer un menu semaine</button>
      <div id="batch-result" class="mt-6"></div>
    </div>
  </div>

  <script>
    // ---------- BASE DE DONNÉES (grammage + kcal) ----------
    const ingredientsSalad = [
      { name: "Feuilles de riz", emoji: "🫓", weight: "18g", calories: 65 },
      { name: "Vermicelles de riz", emoji: "🍜", weight: "30g", calories: 107 },
      { name: "Crevettes cuites", emoji: "🦐", weight: "50g", calories: 50 },
      { name: "Blanc de volaille", emoji: "🍗", weight: "60g", calories: 60 },
      { name: "Carottes râpées", emoji: "🥕", weight: "40g", calories: 16 },
      { name: "Laitue", emoji: "🥬", weight: "30g", calories: 6 },
      { name: "Concombre", emoji: "🥒", weight: "50g", calories: 7 },
      { name: "Germes de soja", emoji: "🌱", weight: "30g", calories: 10 },
      { name: "Menthe", emoji: "🌿", weight: "5g", calories: 2 },
      { name: "Persil plat", emoji: "🌿", weight: "5g", calories: 2 },
      { name: "Coriandre", emoji: "🌿", weight: "5g", calories: 2 },
      { name: "Jeunes oignons", emoji: "🧅", weight: "10g", calories: 5 },
      { name: "Pousses d’épinards", emoji: "🥗", weight: "30g", calories: 8 },
      { name: "Huile d’olive", emoji: "🫒", weight: "10g", calories: 90 },
      { name: "Vinaigre", emoji: "🥄", weight: "10g", calories: 1 },
      { name: "Citron", emoji: "🍋", weight: "10g", calories: 3 },
      { name: "Cacahuètes", emoji: "🥜", weight: "15g", calories: 90 },
      { name: "Feta", emoji: "🧀", weight: "25g", calories: 65 },
      { name: "Burrata", emoji: "🥛", weight: "40g", calories: 80 },
      { name: "Myrtilles", emoji: "🫐", weight: "30g", calories: 18 },
      { name: "Melon", emoji: "🍈", weight: "50g", calories: 20 },
      { name: "Pastèque", emoji: "🍉", weight: "50g", calories: 17 },
      { name: "Nectarine", emoji: "🍑", weight: "50g", calories: 23 },
      { name: "Olives noires", emoji: "🫒", weight: "10g", calories: 14 },
      { name: "Basilic", emoji: "🌱", weight: "5g", calories: 1 },
      { name: "Tomates cerises", emoji: "🍅", weight: "40g", calories: 8 },
      { name: "Chou-fleur", emoji: "🥦", weight: "40g", calories: 10 },
      { name: "Noix de pécan", emoji: "🥜", weight: "10g", calories: 72 },
      { name: "Pignons de pin", emoji: "🌰", weight: "10g", calories: 67 },
      { name: "Graines de sésame", emoji: "🌾", weight: "10g", calories: 55 }
    ];

    const ingredientsPlat = [
      { name: "Tortilla blé complet", emoji: "🌯", weight: "1 pièce", calories: 120 },
      { name: "Épices pour poulet", emoji: "🧂", weight: "3g", calories: 8 },
      { name: "Ail", emoji: "🧄", weight: "5g", calories: 7 },
      { name: "Oignon rouge", emoji: "🧅", weight: "30g", calories: 12 },
      { name: "Yaourt nature maigre", emoji: "🥣", weight: "50g", calories: 25 },
      { name: "Steak de bœuf", emoji: "🥩", weight: "80g", calories: 170 },
      { name: "Sauce soja", emoji: "🥄", weight: "10g", calories: 6 },
      { name: "Poivron rouge", emoji: "🫑", weight: "40g", calories: 10 },
      { name: "Échalote", emoji: "🧅", weight: "15g", calories: 6 },
      { name: "Thon à l’huile", emoji: "🐟", weight: "40g", calories: 90 },
      { name: "Oignon", emoji: "🧅", weight: "30g", calories: 12 },
      { name: "Dinde", emoji: "🍖", weight: "60g", calories: 60 },
      { name: "Épices tandoori", emoji: "🌶️", weight: "2g", calories: 7 },
      { name: "Piment d’Espelette", emoji: "🌶️", weight: "2g", calories: 7 },
      { name: "Faisselle", emoji: "🥛", weight: "50g", calories: 35 },
      { name: "Pâte brisée", emoji: "🥧", weight: "50g", calories: 175 },
      { name: "Poireau", emoji: "🧅", weight: "40g", calories: 14 },
      { name: "Jambon", emoji: "🍖", weight: "40g", calories: 45 },
      { name: "Œufs", emoji: "🥚", weight: "1", calories: 72 },
      { name: "Muscade", emoji: "🌰", weight: "1g", calories: 6 },
      { name: "Pommes de terre", emoji: "🥔", weight: "80g", calories: 60 },
      { name: "Riz", emoji: "🍚", weight: "60g", calories: 86 },
      { name: "Semoule", emoji: "🍚", weight: "60g", calories: 98 },
      { name: "Pâtes complètes", emoji: "🍝", weight: "60g", calories: 90 },
      { name: "Lait écrémé", emoji: "🥛", weight: "60ml", calories: 21 },
      { name: "Saumon fumé", emoji: "🐟", weight: "30g", calories: 50 },
      { name: "St Môret light", emoji: "🧀", weight: "20g", calories: 34 },
      { name: "Noix", emoji: "🥜", weight: "10g", calories: 67 }
    ];

    // Plats (avec ingrédients détaillés, voir partie 1/3 pour la structure)
    const platsDB = [
      {
        name: "Wrap maison",
        emoji: "🌯",
        ingredients: [
          "Tortilla blé complet",
          "Blanc de volaille",
          "Épices pour poulet",
          "Yaourt nature maigre",
          "Laitue",
          "Carottes râpées",
          "Oignon rouge"
        ],
        steps: [
          "Émincer et cuire le blanc de volaille avec les épices.",
          "Mélanger le yaourt avec des herbes pour la sauce.",
          "Étaler la sauce sur la tortilla, ajouter légumes et viande.",
          "Rouler et servir frais ou tiède."
        ],
        astuce: "Pour un wrap plus frais, ajoute quelques feuilles de menthe ou de coriandre."
      },
      {
        name: "Rouleaux de printemps",
        emoji: "🫓",
        ingredients: [
          "Feuilles de riz",
          "Crevettes cuites",
          "Vermicelles de riz",
          "Carottes râpées",
          "Concombre",
          "Germes de soja",
          "Menthe",
          "Persil plat"
        ],
        steps: [
          "Cuire et rincer les vermicelles de riz.",
          "Réhydrater les feuilles de riz.",
          "Déposer légumes, vermicelles, herbes, crevettes sur la feuille.",
          "Rouler fermement. Servir avec sauce soja/cacahuètes."
        ],
        astuce: "Roulez bien serré pour éviter que les rouleaux ne se défassent à la découpe."
      }
      // ... (Tu peux rajouter tes autres plats ici, même format)
    ];

    const astucesSalades = [
      "Ajoute quelques herbes fraîches pour booster la saveur.",
      "Mélange plusieurs huiles pour une vinaigrette unique.",
      "Pense aux fruits frais pour un twist sucré-salé.",
      "Torréfie les graines pour plus de croquant.",
      "Ajoute un peu de zeste de citron dans ta sauce."
    ];

    function getRandomElement(arr) {
      return arr[Math.floor(Math.random() * arr.length)];
    }

    function showView(id) {
      document.querySelectorAll('body > div').forEach(div => div.classList.add('hidden'));
      document.getElementById(id).classList.remove('hidden');
      if (id === "composer-view") document.getElementById('composer-result').innerHTML = '';
      if (id === "generator-salad-view") document.getElementById('generator-salad-result').innerHTML = '';
      if (id === "generator-plat-view") document.getElementById('generator-plat-result').innerHTML = '';
      if (id === "batch-view") document.getElementById('batch-result').innerHTML = '';
    }

    function generateSalad() {
      let ingrs = [];
      ingrs.push(getRandomElement(ingredientsSalad.filter(i => ["Laitue", "Pousses d’épinards", "Feuilles de riz"].includes(i.name))));
      let pool = ingredientsSalad.filter(i => !ingrs.some(b => b.name === i.name));
      for (let i = 0; i < 4; i++) ingrs.push(getRandomElement(pool.splice(Math.floor(Math.random()*pool.length),1)));
      let nom = "Salade " + ingrs[0].name + " & " + ingrs[1].name;
      let etapes = [
        `Déposer la base (${ingrs[0].emoji} ${ingrs[0].name}) dans une grande assiette.`,
        ...ingrs.slice(1).map(ing => `Ajouter ${ing.emoji} ${ing.name}.`),
        "Assaisonner selon ton goût. Mélanger et servir frais."
      ];
      let astuce = getRandomElement(astucesSalades);
      document.getElementById('generator-salad-result').innerHTML = recipeCard(nom, ingrs, etapes, astuce, 'salad');
    }

    function generatePlat() {
      let plat = getRandomElement(platsDB);
      let ingrs = plat.ingredients.map(n => {
        return ingredientsPlat.find(i => i.name === n) || ingredientsSalad.find(i => i.name === n) || { name: n, emoji: "🍽️", weight: "?", calories: 0 };
      });
      document.getElementById('generator-plat-result').innerHTML = recipeCard(plat.emoji + " " + plat.name, ingrs, plat.steps, plat.astuce, 'plat');
    }

    function selectComposerType(type) {
      document.getElementById('composer-title').textContent = type === "salad" ? "Composer une Salade" : "Composer un Plat";
      let ingrs = (type === "salad" ? ingredientsSalad : ingredientsPlat);
      let html = '';
      ingrs.forEach((i, idx) => {
        html += `<label class="inline-flex items-center gap-1 bg-white/70 rounded-lg px-2 py-1 shadow border mb-2 mr-2">
            <input type="checkbox" name="comp-ingr" value="${i.name}" class="accent-pink-500">
            <span>${i.emoji} ${i.name} <span class="text-xs text-gray-500">(${i.weight}, ${i.calories} kcal)</span></span>
        </label>`;
      });
      document.getElementById('composer-ingredients').innerHTML = html;
      document.getElementById('composer-form').setAttribute('data-type', type);
      showView('composer-view');
    }

    function composeSaladPlat() {
      let form = document.getElementById('composer-form');
      let type = form.getAttribute('data-type');
      let selected = Array.from(form.querySelectorAll('input[type=checkbox]:checked')).map(i => i.value);
      if (!selected.length) { alert("Sélectionne au moins un ingrédient !"); return; }
      let base = (type === "salad" ? ingredientsSalad : ingredientsPlat);
      let ingrs = base.filter(i => selected.includes(i.name));
      let nom = (type === "salad" ? "Salade" : "Plat") + " " + ingrs[0].name;
      let etapes = ingrs.map(i => `Ajouter ${i.emoji} ${i.name} (${i.weight}).`);
      etapes.push("Mélanger (ou assembler/cuire selon le plat). Servir.");
      let astuce = type === "salad" ? getRandomElement(astucesSalades) : "Teste différentes associations pour plus de variété.";
      document.getElementById('composer-result').innerHTML = recipeCard(nom, ingrs, etapes, astuce, type);
    }
    // Carte recette complète, affichage calories et grammages
    function recipeCard(nom, ingrs, etapes, astuce, type) {
      let totalKcal = ingrs.reduce((s, i) => s + (i.calories || 0), 0);
      return `
      <div class="card">
        <h3 class="font-display text-xl mb-2">${nom}</h3>
        <ul class="mb-3">
          ${ingrs.map(ing =>
            `<li>${ing.emoji} <b>${ing.name}</b> <span class="text-xs text-gray-500">(${ing.weight}, ${ing.calories} kcal)</span></li>`
          ).join('')}
        </ul>
        <div class="mb-2">
          <ol class="list-decimal list-inside text-sm text-gray-700 mb-3">
            ${etapes.map(e => `<li>${e}</li>`).join('')}
          </ol>
          <div class="mb-2"><b>Total&nbsp;: ${totalKcal} kcal</b></div>
          <div class="text-pink-600 italic mb-2">Astuce : ${astuce}</div>
        </div>
        <button onclick="shareRecipe(this)" class="mt-2 mr-2 px-4 py-2 rounded-xl bg-blue-500 text-white font-bold text-base hover:bg-blue-600">Partager</button>
      </div>
      `;
    }

    // Partage recette
    function shareRecipe(btn) {
      const card = btn.closest('.card');
      let titre = card.querySelector('h3').innerText;
      let ing = Array.from(card.querySelectorAll('ul li')).map(li => li.innerText).join('\n');
      let etapes = Array.from(card.querySelectorAll('ol li')).map(li => li.innerText).join('\n');
      let astuce = card.querySelector('.italic').innerText;
      let total = card.querySelector('b').innerText;
      let text = `${titre}\n\nIngrédients:\n${ing}\n\nPréparation:\n${etapes}\n\n${total}\n${astuce}`;
      if (navigator.share) {
        navigator.share({ title: titre, text });
        btn.innerText = "Partagé !";
      } else {
        navigator.clipboard.writeText(text);
        btn.innerText = "Copié !";
      }
      setTimeout(() => btn.innerText = "Partager", 2000);
    }

    // Planification semaine
    function generateBatch() {
      let result = [];
      for (let i = 0; i < 5; i++) {
        if (i % 2 === 0) { // Salade
          let ingrs = [];
          ingrs.push(getRandomElement(ingredientsSalad.filter(x => ["Laitue", "Pousses d’épinards", "Feuilles de riz"].includes(x.name))));
          let pool = ingredientsSalad.filter(i => !ingrs.some(b => b.name === i.name));
          for (let j = 0; j < 4; j++) ingrs.push(getRandomElement(pool.splice(Math.floor(Math.random()*pool.length),1)));
          let nom = "Salade " + ingrs[0].name + " & " + ingrs[1].name;
          let etapes = [
            `Déposer la base (${ingrs[0].emoji} ${ingrs[0].name}) dans une grande assiette.`,
            ...ingrs.slice(1).map(ing => `Ajouter ${ing.emoji} ${ing.name} (${ing.weight}).`),
            "Assaisonner selon ton goût. Mélanger et servir frais."
          ];
          let astuce = getRandomElement(astucesSalades);
          result.push(recipeCard(nom, ingrs, etapes, astuce, 'salad'));
        } else { // Plat
          let plat = getRandomElement(platsDB);
          let ingrs = plat.ingredients.map(n => {
            return ingredientsPlat.find(i => i.name === n) || ingredientsSalad.find(i => i.name === n) || { name: n, emoji: "🍽️", weight: "?", calories: 0 };
          });
          result.push(recipeCard(plat.emoji + " " + plat.name, ingrs, plat.steps, plat.astuce, 'plat'));
        }
      }
      let block = `<div>${result.join('')}</div>
      <button onclick="batchShare()" class="mt-3 px-4 py-2 rounded-xl bg-blue-500 text-white font-bold text-base hover:bg-blue-600">Partager le menu semaine</button>`;
      document.getElementById('batch-result').innerHTML = block;
    }

    function batchShare() {
      let el = document.getElementById('batch-result');
      let text = Array.from(el.querySelectorAll('h3, ul, ol, .italic, b')).map(e => e.innerText).join('\n');
      if (navigator.share) {
        navigator.share({ title: "Menu Semaine Coach Salade", text });
      } else {
        navigator.clipboard.writeText(text);
        alert("Menu copié dans le presse-papier !");
      }
    }

  </script>
</body>
</html>
