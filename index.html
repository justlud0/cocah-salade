<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Coach Salade 2.1</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Montserrat:wght@400;500&display=swap" rel="stylesheet">
  <style>
    html, body {
      height: 100%;
      margin: 0;
      font-family: 'Montserrat', sans-serif;
      background: linear-gradient(135deg, #ec4899 0%, #7f9cf5 100%);
      min-height: 100vh;
      background-attachment: fixed;
    }
    h1, h2, .font-display {
      font-family: 'Playfair Display', serif;
    }
    .card {
      background: rgba(255,255,255,0.7);
      backdrop-filter: blur(10px);
      border-radius: 1.5rem;
      box-shadow: 0 4px 32px 0 rgba(0,0,0,0.08);
      padding: 1.5rem;
      margin-bottom: 1rem;
    }
    .pie {
      width: 112px;
      height: 112px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      background: conic-gradient(var(--main) calc(var(--pct)*1%), #eee 0 100%);
    }
    .pie-text {
      position: absolute;
      left: 0;
      right: 0;
      top: 0;
      bottom: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      font-size: 1.5rem;
      color: #ec4899;
    }
  </style>
</head>
<body class="flex flex-col items-center justify-center min-h-screen">

  <!-- Menu principal -->
  <div id="menu-view" class="w-full max-w-md mx-auto flex flex-col items-center justify-center min-h-screen">
    <div class="card w-full text-center">
      <h1 class="font-display text-3xl mb-4">Coach Salade 🥗</h1>
      <button onclick="showView('generator-salad-view')" class="w-full mb-3 px-4 py-3 rounded-2xl bg-pink-500 text-white font-bold text-lg shadow-md transition hover:bg-pink-600">Générer une Salade</button>
      <button onclick="showView('generator-plat-view')" class="w-full mb-3 px-4 py-3 rounded-2xl bg-yellow-400 text-gray-800 font-bold text-lg shadow-md transition hover:bg-yellow-500">Générer un Plat</button>
      <button onclick="showView('composer-type-view')" class="w-full px-4 py-3 rounded-2xl bg-white border-2 border-pink-500 text-pink-500 font-bold text-lg shadow-md transition hover:bg-pink-50">Composer</button>
      <button onclick="showView('batch-view')" class="w-full mt-3 px-4 py-3 rounded-2xl bg-blue-500 text-white font-bold text-lg shadow-md transition hover:bg-blue-600">Planification Semaine</button>
    </div>
    <footer class="text-xs text-gray-600 opacity-80 mt-12">Coach Salade 2.1 • © 2025</footer>
  </div>

  <!-- Générateur de Salade -->
  <div id="generator-salad-view" class="hidden w-full max-w-md mx-auto flex flex-col items-center min-h-screen pt-6">
    <button onclick="showView('menu-view')" class="mb-2 text-pink-500 font-semibold flex items-center gap-1">⬅️ Menu</button>
    <div class="card w-full">
      <h2 class="font-display text-2xl mb-3">Générateur de Salade 🎲</h2>
      <button id="generate-salad-btn" onclick="generateSalad()" class="w-full px-4 py-3 rounded-2xl bg-pink-500 text-white font-bold text-lg shadow-md transition hover:bg-pink-600">Nouvelle Salade</button>
      <div id="generator-salad-result" class="mt-6"></div>
    </div>
  </div>

  <!-- Générateur de Plat -->
  <div id="generator-plat-view" class="hidden w-full max-w-md mx-auto flex flex-col items-center min-h-screen pt-6">
    <button onclick="showView('menu-view')" class="mb-2 text-yellow-500 font-semibold flex items-center gap-1">⬅️ Menu</button>
    <div class="card w-full">
      <h2 class="font-display text-2xl mb-3">Générateur de Plat 🍽️</h2>
      <button id="generate-plat-btn" onclick="generatePlat()" class="w-full px-4 py-3 rounded-2xl bg-yellow-400 text-gray-800 font-bold text-lg shadow-md transition hover:bg-yellow-500">Nouveau Plat</button>
      <div id="generator-plat-result" class="mt-6"></div>
    </div>
  </div>

  <!-- Sélecteur type compositeur -->
  <div id="composer-type-view" class="hidden w-full max-w-md mx-auto flex flex-col items-center min-h-screen pt-6">
    <button onclick="showView('menu-view')" class="mb-2 text-pink-500 font-semibold flex items-center gap-1">⬅️ Menu</button>
    <div class="card w-full text-center">
      <h2 class="font-display text-2xl mb-3">Composer une recette</h2>
      <p class="mb-4">Que veux-tu composer&nbsp;?</p>
      <button onclick="selectComposerType('salad')" class="w-full mb-3 px-4 py-3 rounded-2xl bg-pink-500 text-white font-bold text-lg shadow-md transition hover:bg-pink-600">Salade</button>
      <button onclick="selectComposerType('plat')" class="w-full px-4 py-3 rounded-2xl bg-yellow-400 text-gray-800 font-bold text-lg shadow-md transition hover:bg-yellow-500">Plat</button>
    </div>
  </div>

  <!-- Compositeur -->
  <div id="composer-view" class="hidden w-full max-w-md mx-auto flex flex-col items-center min-h-screen pt-6">
    <button onclick="showView('composer-type-view')" class="mb-2 text-pink-500 font-semibold flex items-center gap-1">⬅️ Retour</button>
    <div class="card w-full">
      <h2 id="composer-title" class="font-display text-2xl mb-3"></h2>
      <form id="composer-form" onsubmit="event.preventDefault(); composeSaladPlat();">
        <div id="composer-ingredients"></div>
        <button type="submit" class="w-full mt-4 px-4 py-3 rounded-2xl bg-pink-500 text-white font-bold text-lg shadow-md transition hover:bg-pink-600">Composer</button>
      </form>
      <div id="composer-result" class="mt-6"></div>
    </div>
  </div>
  <!-- Planification Semaine -->
  <div id="batch-view" class="hidden w-full max-w-md mx-auto flex flex-col items-center min-h-screen pt-6">
    <button onclick="showView('menu-view')" class="mb-2 text-blue-500 font-semibold flex items-center gap-1">⬅️ Menu</button>
    <div class="card w-full">
      <h2 class="font-display text-2xl mb-3">Planification semaine 📅</h2>
      <button onclick="generateBatch()" class="w-full px-4 py-3 rounded-2xl bg-blue-500 text-white font-bold text-lg shadow-md transition hover:bg-blue-600">Générer un menu semaine</button>
      <div id="batch-result" class="mt-6"></div>
    </div>
  </div>

  <script>
    // ---------- BASE DE DONNÉES ----------

    // Ingrédients SALADE (issu de tes recettes)
    const ingredientsSalad = [
      { name: "Feuilles de riz", emoji: "🫓" },
      { name: "Vermicelles de riz", emoji: "🍜" },
      { name: "Crevettes cuites", emoji: "🦐" },
      { name: "Blanc de volaille", emoji: "🍗" },
      { name: "Carottes râpées", emoji: "🥕" },
      { name: "Laitue", emoji: "🥬" },
      { name: "Concombre", emoji: "🥒" },
      { name: "Germes de soja", emoji: "🌱" },
      { name: "Menthe", emoji: "🌿" },
      { name: "Persil plat", emoji: "🌿" },
      { name: "Coriandre", emoji: "🌿" },
      { name: "Jeunes oignons", emoji: "🧅" },
      { name: "Pousses d’épinards", emoji: "🥗" },
      { name: "Huile d’olive", emoji: "🫒" },
      { name: "Vinaigre", emoji: "🥄" },
      { name: "Citron", emoji: "🍋" },
      { name: "Cacahuètes", emoji: "🥜" },
      { name: "Feta", emoji: "🧀" },
      { name: "Burrata", emoji: "🥛" },
      { name: "Myrtilles", emoji: "🫐" },
      { name: "Melon", emoji: "🍈" },
      { name: "Pastèque", emoji: "🍉" },
      { name: "Nectarine", emoji: "🍑" },
      { name: "Olives noires", emoji: "🫒" },
      { name: "Basilic", emoji: "🌱" },
      { name: "Tomates cerises", emoji: "🍅" },
      { name: "Chou-fleur", emoji: "🥦" },
      { name: "Noix de pécan", emoji: "🥜" },
      { name: "Pignons de pin", emoji: "🌰" },
      { name: "Graines de sésame", emoji: "🌾" }
    ];

    // Ingrédients PLAT (issu de tes recettes)
    const ingredientsPlat = [
      { name: "Tortilla blé complet", emoji: "🌯" },
      { name: "Épices pour poulet", emoji: "🧂" },
      { name: "Ail", emoji: "🧄" },
      { name: "Oignon rouge", emoji: "🧅" },
      { name: "Yaourt nature maigre", emoji: "🥣" },
      { name: "Steak de bœuf", emoji: "🥩" },
      { name: "Sauce soja", emoji: "🥄" },
      { name: "Poivron rouge", emoji: "🫑" },
      { name: "Échalote", emoji: "🧅" },
      { name: "Thon à l’huile", emoji: "🐟" },
      { name: "Oignon", emoji: "🧅" },
      { name: "Dinde", emoji: "🍖" },
      { name: "Yaourt nature maigre", emoji: "🥣" },
      { name: "Épices tandoori", emoji: "🌶️" },
      { name: "Piment d’Espelette", emoji: "🌶️" },
      { name: "Faisselle", emoji: "🥛" },
      { name: "Pâte brisée", emoji: "🥧" },
      { name: "Poireau", emoji: "🧅" },
      { name: "Jambon", emoji: "🍖" },
      { name: "Œufs", emoji: "🥚" },
      { name: "Muscade", emoji: "🌰" },
      { name: "Pommes de terre", emoji: "🥔" },
      { name: "Riz", emoji: "🍚" },
      { name: "Semoule", emoji: "🍚" },
      { name: "Pâtes complètes", emoji: "🍝" },
      { name: "Lait écrémé", emoji: "🥛" },
      { name: "Saumon fumé", emoji: "🐟" },
      { name: "St Môret light", emoji: "🧀" },
      { name: "Noix", emoji: "🥜" }
    ];

    // Plats réels issus de tes recettes (simplifié pour ce code, à enrichir selon besoin)
    const platsDB = [
      {
        name: "Wrap maison",
        emoji: "🌯",
        ingredients: [
          "Tortilla blé complet",
          "Blanc de volaille",
          "Épices pour poulet",
          "Yaourt nature maigre",
          "Laitue",
          "Carottes râpées",
          "Oignon rouge"
        ],
        steps: [
          "Émincer et cuire le blanc de volaille avec les épices.",
          "Mélanger le yaourt avec des herbes pour la sauce.",
          "Étaler la sauce sur la tortilla, ajouter légumes et viande.",
          "Rouler et servir frais ou tiède."
        ],
        astuce: "Pour un wrap plus frais, ajoute quelques feuilles de menthe ou de coriandre."
      },
      {
        name: "Rouleaux de printemps",
        emoji: "🫓",
        ingredients: [
          "Feuilles de riz",
          "Crevettes cuites",
          "Vermicelles de riz",
          "Carottes râpées",
          "Concombre",
          "Germes de soja",
          "Menthe",
          "Persil plat"
        ],
        steps: [
          "Cuire et rincer les vermicelles de riz.",
          "Réhydrater les feuilles de riz.",
          "Déposer légumes, vermicelles, herbes, crevettes sur la feuille.",
          "Rouler fermement. Servir avec sauce soja/cacahuètes."
        ],
        astuce: "Roulez bien serré pour éviter que les rouleaux ne se défassent à la découpe."
      },
      {
        name: "Quiche jambon-poireau",
        emoji: "🥧",
        ingredients: [
          "Pâte brisée",
          "Poireau",
          "Jambon",
          "Œufs",
          "Lait écrémé",
          "Muscade"
        ],
        steps: [
          "Préchauffer le four à 180°C.",
          "Faire revenir les poireaux émincés.",
          "Fouetter œufs, lait, muscade, ajouter poireaux et jambon.",
          "Verser sur la pâte, cuire 35 min."
        ],
        astuce: "Laisse tiédir avant de couper pour une quiche bien ferme."
      },
      {
        name: "Pâtes complètes au chou-fleur & thon",
        emoji: "🍝",
        ingredients: [
          "Pâtes complètes",
          "Chou-fleur",
          "Thon à l’huile",
          "Échalote",
          "Huile d’olive"
        ],
        steps: [
          "Cuire les pâtes et le chou-fleur séparément.",
          "Faire revenir l’échalote, ajouter le chou-fleur.",
          "Mélanger pâtes, chou-fleur, thon égoutté.",
          "Servir chaud, arroser d’un filet d’huile d’olive."
        ],
        astuce: "Ajoute un peu de zeste de citron pour relever le goût du thon."
      },
      {
        name: "Brochettes de dinde sésame & salsa pastèque",
        emoji: "🍢",
        ingredients: [
          "Dinde",
          "Graines de sésame",
          "Pastèque",
          "Menthe",
          "Yaourt nature maigre"
        ],
        steps: [
          "Enrober la dinde de graines de sésame et cuire à la poêle.",
          "Couper la pastèque en dés, mélanger avec yaourt et menthe.",
          "Servir les brochettes chaudes, salsa à côté."
        ],
        astuce: "Utilise des pics en bois trempés pour éviter qu’ils ne brûlent à la cuisson."
      }
    ];

    // Astuces cuisine salades (random selon résultat)
    const astucesSalades = [
      "Ajoute quelques herbes fraîches pour booster la saveur.",
      "Mélange plusieurs huiles pour une vinaigrette unique.",
      "Pense aux fruits frais pour un twist sucré-salé.",
      "Torréfie les graines pour plus de croquant.",
      "Ajoute un peu de zeste de citron dans ta sauce."
    ];

    // Utilitaires random
    function getRandomElement(arr) {
      return arr[Math.floor(Math.random() * arr.length)];
    }

    // Navigation SPA
    function showView(id) {
      document.querySelectorAll('body > div').forEach(div => div.classList.add('hidden'));
      document.getElementById(id).classList.remove('hidden');
      if (id === "composer-view") document.getElementById('composer-result').innerHTML = '';
      if (id === "generator-salad-view") document.getElementById('generator-salad-result').innerHTML = '';
      if (id === "generator-plat-view") document.getElementById('generator-plat-result').innerHTML = '';
      if (id === "batch-view") document.getElementById('batch-result').innerHTML = '';
    }

    // Générer une salade (random vraie base)
    function generateSalad() {
      let ingrs = [];
      // Une base salade
      ingrs.push(getRandomElement(ingredientsSalad.filter(i => ["Laitue", "Pousses d’épinards", "Feuilles de riz"].includes(i.name))));
      // 3 à 5 ingrédients random en plus
      let pool = ingredientsSalad.filter(i => !ingrs.some(b => b.name === i.name));
      for (let i = 0; i < 4; i++) ingrs.push(getRandomElement(pool.splice(Math.floor(Math.random()*pool.length),1)));
      // Construction recette
      let nom = "Salade " + ingrs[0].name + " & " + ingrs[1].name;
      let etapes = [
        `Déposer la base (${ingrs[0].emoji} ${ingrs[0].name}) dans une grande assiette.`,
        ...ingrs.slice(1).map(ing => `Ajouter ${ing.emoji} ${ing.name}.`),
        "Assaisonner selon ton goût. Mélanger et servir frais."
      ];
      let astuce = getRandomElement(astucesSalades);
      document.getElementById('generator-salad-result').innerHTML = recipeCard(nom, ingrs, etapes, astuce, 'salad');
    }

    // Générer un plat (random réel)
    function generatePlat() {
      let plat = getRandomElement(platsDB);
      let ingrs = plat.ingredients.map(n => {
        let i = ingredientsPlat.find(i => i.name === n) || ingredientsSalad.find(i => i.name === n) || { name: n, emoji: "🍽️" };
        return i;
      });
      document.getElementById('generator-plat-result').innerHTML = recipeCard(plat.emoji + " " + plat.name, ingrs, plat.steps, plat.astuce, 'plat');
    }

    // Compositeur : type (salade ou plat)
    function selectComposerType(type) {
      document.getElementById('composer-title').textContent = type === "salad" ? "Composer une Salade" : "Composer un Plat";
      let ingrs = (type === "salad" ? ingredientsSalad : ingredientsPlat);
      let html = '';
      ingrs.forEach((i, idx) => {
        html += `<label class="inline-flex items-center gap-1 bg-white/70 rounded-lg px-2 py-1 shadow border mb-2 mr-2">
            <input type="checkbox" name="comp-ingr" value="${i.name}" class="accent-pink-500">
            <span>${i.emoji} ${i.name}</span>
        </label>`;
      });
      document.getElementById('composer-ingredients').innerHTML = html;
      document.getElementById('composer-form').setAttribute('data-type', type);
      showView('composer-view');
    }
    // Compositeur : construction de recette
    function composeSaladPlat() {
      let form = document.getElementById('composer-form');
      let type = form.getAttribute('data-type');
      let selected = Array.from(form.querySelectorAll('input[type=checkbox]:checked')).map(i => i.value);
      if (!selected.length) { alert("Sélectionne au moins un ingrédient !"); return; }
      let ingrs = (type === "salad" ? ingredientsSalad : ingredientsPlat).filter(i => selected.includes(i.name));
      let nom = (type === "salad" ? "Salade" : "Plat") + " " + ingrs[0].name;
      let etapes = ingrs.map(i => `Ajouter ${i.emoji} ${i.name}.`);
      etapes.push("Mélanger (ou assembler/cuire selon le plat). Servir.");
      let astuce = type === "salad" ? getRandomElement(astucesSalades) : "Teste différentes associations pour plus de variété.";
      document.getElementById('composer-result').innerHTML = recipeCard(nom, ingrs, etapes, astuce, type);
    }
    // Affichage d'une carte recette, partage intégré
    function recipeCard(nom, ingrs, etapes, astuce, type) {
      return `
      <div class="card">
        <h3 class="font-display text-xl mb-2">${nom}</h3>
        <ul class="mb-3">
          ${ingrs.map(ing => `<li>${ing.emoji} <b>${ing.name}</b></li>`).join('')}
        </ul>
        <div class="mb-2">
          <ol class="list-decimal list-inside text-sm text-gray-700 mb-3">
            ${etapes.map(e => `<li>${e}</li>`).join('')}
          </ol>
          <div class="text-pink-600 italic mb-2">Astuce : ${astuce}</div>
        </div>
        <button onclick="shareRecipe(this)" class="mt-2 mr-2 px-4 py-2 rounded-xl bg-blue-500 text-white font-bold text-base hover:bg-blue-600">Partager</button>
      </div>
      `;
    }

    // Partage recette (Web Share API ou fallback copie)
    function shareRecipe(btn) {
      const card = btn.closest('.card');
      let titre = card.querySelector('h3').innerText;
      let ing = Array.from(card.querySelectorAll('ul li')).map(li => li.innerText).join('\n');
      let etapes = Array.from(card.querySelectorAll('ol li')).map(li => li.innerText).join('\n');
      let astuce = card.querySelector('.italic').innerText;
      let text = `${titre}\n\nIngrédients:\n${ing}\n\nPréparation:\n${etapes}\n\n${astuce}`;
      if (navigator.share) {
        navigator.share({ title: titre, text });
        btn.innerText = "Partagé !";
      } else {
        navigator.clipboard.writeText(text);
        btn.innerText = "Copié !";
      }
      setTimeout(() => btn.innerText = "Partager", 2000);
    }

    // Planification semaine (batch cooking)
    function generateBatch() {
      // 5 menus variés (aléa : salade/plat/salade/plat/salade)
      let result = [];
      for (let i = 0; i < 5; i++) {
        if (i % 2 === 0) { // Salade
          let ingrs = [];
          ingrs.push(getRandomElement(ingredientsSalad.filter(x => ["Laitue", "Pousses d’épinards", "Feuilles de riz"].includes(x.name))));
          let pool = ingredientsSalad.filter(i => !ingrs.some(b => b.name === i.name));
          for (let j = 0; j < 4; j++) ingrs.push(getRandomElement(pool.splice(Math.floor(Math.random()*pool.length),1)));
          let nom = "Salade " + ingrs[0].name + " & " + ingrs[1].name;
          let etapes = [
            `Déposer la base (${ingrs[0].emoji} ${ingrs[0].name}) dans une grande assiette.`,
            ...ingrs.slice(1).map(ing => `Ajouter ${ing.emoji} ${ing.name}.`),
            "Assaisonner selon ton goût. Mélanger et servir frais."
          ];
          let astuce = getRandomElement(astucesSalades);
          result.push(recipeCard(nom, ingrs, etapes, astuce, 'salad'));
        } else { // Plat
          let plat = getRandomElement(platsDB);
          let ingrs = plat.ingredients.map(n => {
            let i = ingredientsPlat.find(i => i.name === n) || ingredientsSalad.find(i => i.name === n) || { name: n, emoji: "🍽️" };
            return i;
          });
          result.push(recipeCard(plat.emoji + " " + plat.name, ingrs, plat.steps, plat.astuce, 'plat'));
        }
      }
      let block = `<div>${result.join('')}</div>
      <button onclick="batchShare()" class="mt-3 px-4 py-2 rounded-xl bg-blue-500 text-white font-bold text-base hover:bg-blue-600">Partager le menu semaine</button>`;
      document.getElementById('batch-result').innerHTML = block;
    }

    // Partage du menu semaine
    function batchShare() {
      let el = document.getElementById('batch-result');
      let text = Array.from(el.querySelectorAll('h3, ul, ol, .italic')).map(e => e.innerText).join('\n');
      if (navigator.share) {
        navigator.share({ title: "Menu Semaine Coach Salade", text });
      } else {
        navigator.clipboard.writeText(text);
        alert("Menu copié dans le presse-papier !");
      }
    }

  </script>
</body>
</html>

